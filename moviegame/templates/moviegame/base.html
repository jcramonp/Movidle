{% load static %}
{% load i18n %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Movidle{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'moviegame/app.css' %}">
  {% block head %}{% endblock %}
</head>
<body class="bg">
  <header class="header">
  {% if navbar_mode == 'admin' %}
    <!-- Navbar reducida para el panel -->
    <a class="brand-btn" href="{% url 'moviegame:admin_dashboard' %}">panel</a>
    <nav class="nav">
      <form action="{% url 'moviegame:logout' %}" method="post" style="display:inline">
        {% csrf_token %}<button type="submit" class="btn">Salir</button>
      </form>

      <!-- Selector de idioma dentro del nav (alineado a los demás) -->
      <form action="{% url 'set_language' %}" method="post" style="display:inline-flex; gap:6px; align-items:center;">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.get_full_path }}">
        {% get_current_language as LANGUAGE_CODE %}
        {% get_available_languages as LANGUAGES %}
        {% get_language_info_list for LANGUAGES as languages %}
        <select name="language" onchange="this.form.submit()" class="btn" style="padding:6px 10px; border-radius:999px;">
          {% for lang in languages %}
            <option value="{{ lang.code }}" {% if lang.code == LANGUAGE_CODE %}selected{% endif %}>
              {{ lang.name_local|capfirst }}
            </option>
          {% endfor %}
        </select>
      </form>
    </nav>
  {% else %}
   {# Navbar normal del sitio #}
    <a class="brand-btn" href="{% url 'moviegame:home' %}">movidle</a>

    <nav class="nav">
      {% if user.is_staff %}
        {# --- Solo admins --- #}
        <a class="btn" href="{% url 'moviegame:admin_dashboard' %}">{% trans "Panel" %}</a>
        <a class="btn" href="{% url 'moviegame:api_info' %}">{% trans "API" %}</a>
        <form action="{% url 'moviegame:logout' %}" method="post" style="display:inline">
          {% csrf_token %}
          <button type="submit" class="btn">{% trans "Salir" %}</button>
        </form>

      {% else %}
        {# --- Jugadores --- #}
        {% if user.is_authenticated %}
          <a class="btn" href="{% url 'moviegame:stats' %}">{% trans "Estadísticas" %}</a>
        {% endif %}

        <a class="btn" href="{% url 'moviegame:howto' %}">{% trans "Cómo jugar" %}</a>
        <a class="btn" href="{% url 'moviegame:api_info' %}">{% trans "API" %}</a>

        {% if user.is_authenticated %}
          <form action="{% url 'moviegame:logout' %}" method="post" style="display:inline">
            {% csrf_token %}
            <button type="submit" class="btn">{% trans "Salir" %}</button>
          </form>
        {% else %}
          <a class="btn" href="{% url 'moviegame:login' %}">{% trans "Entrar" %}</a>
          <a class="btn" href="{% url 'moviegame:register' %}">{% trans "Registro" %}</a>
        {% endif %}
      {% endif %}
    </nav>


        <!-- Selector de idioma dentro del nav (alineado a los demás) -->
        <form action="{% url 'set_language' %}" method="post" style="display:inline-flex; gap:6px; align-items:center;">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ request.get_full_path }}">
          {% get_current_language as LANGUAGE_CODE %}
          {% get_available_languages as LANGUAGES %}
          {% get_language_info_list for LANGUAGES as languages %}
          <select name="language" onchange="this.form.submit()" class="btn" style="padding:6px 10px; border-radius:999px;">
            {% for lang in languages %}
              <option value="{{ lang.code }}" {% if lang.code == LANGUAGE_CODE %}selected{% endif %}>
                {{ lang.name_local|capfirst }}
              </option>
            {% endfor %}
          </select>
        </form>
    </nav>
  {% endif %}
</header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>
</body>
</html>
